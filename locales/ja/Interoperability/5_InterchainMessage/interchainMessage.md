このセクションでは、2つのブロックチェーン間で「hello world」メッセージを送るコントラクトを作成します。

## コンストラクタ

まず最初に作成する必要があるのは、関数の`constructor`です。 コンストラクタにより、前のセクションで取り上げた`Gateway` と `Gas Service`を設定します。

コントラクトのデプロイ時に、Ethereum Sepoliaの`Gateway`と`GasService`のアドレスを渡します。アドレスは、Gatewayが`0xe432150cce91c13a887f7D836923d5597adD8E31`でGas Serviceが`0xbE406F0189A0B4cf3A05C286473D23791Dd44Cc6`です。

関連するAxelarのアドレスの全リストは、<a href="https://docs.axelar.dev/resources/contract-addresses/testnet" target="_blank">こちらをご覧ください</a>。

## インターチェーンメッセージの送信

それでは、コンストラクタにインターチェーントランザクションのトリガーに必要な関連Axelarアドレスを設定したら、`setRemoteValue()`に進むことが出来ます。この関数がトランザクションをトリガーします。

この関数は、3つのパラメータを取ります。

1. `_destinationChain`: トランザクションが行われるチェーン
2. `_destinationAddress`: トランザクションが実行される目的のチェーンのアドレス
3. `_message`: 目的のチェーンに渡されるメッセージ

まず、`require`ステートメントがあり、 `msg.value`が値を含んでいることを確認します。 この`msg.value` は、`GasService`の支払いに使用されます。 資金が送信されなかった場合は、トランザクションが取り消されます。Axelarブロックチェーンと目的のチェーンでは、ガスが無いと実行ができないためです。

次に、渡す`_message` をエンコードします。 `_message`が `string`型に設定されていることに注意してください。 Axelarでは、メッセージを`bytes`型として受け取ることになっているので、シンプルに`abi.encode()`に渡すことで`string`を `bytes`に変換します。

これで、エンコードされたメッセージで`GasService`と`Gateway`とやり取りができるようになりました。

`GasService`に定義されている`payNativeGasForContractCall`関数をトリガーしてインターチェーン全体のトランザクションの支払をします。

この関数は、GasServiceセクションで既に説明したパラメータが必要です。 このトランザクションの`sender`は、このコントラクトで`address(this)`で表されています。 `destinationChain`とdestinationAddress`は、この関数のパラメータによってシンプルに渡されます。`payload`は、先ほど取り上げたエンコードされた\_messageです。 最後に、返金アドレスを記述します。このアドレスは、この関数をトリガーするアドレスです。`msg.sender\`を記述することでアドレスを取得できます。

この関数をトリガーすると、送信元のチェーンからAxelarを経由して目的のチェーンへトランザクションを正常に送信したことになります。 しかし、終了するのに必要な最後のステップがあります。

### 目的のチェーンからメッセージを受け取る

目的のチェーンにおいて、インバウンド・インターチェーン・トランザクションは、 `AxelarExecutable`の`_execute()`関数でピックアップされ、処理されなければなりません。

`_execute()`関数は、`AxelarExecutable`コントラクトで定義されており、この関数を定義する場合には、`override`キーワードを含めなければならないことを忘れないでください。

この関数は、次の3つのパラメータを取ります。

1. `_sourceChain`: トランザクションが発生したブロックチェーン
2. `_sourceAddress`: トランザクションが送られてきた送信元のチェーンのアドレス
3. `_payload`: 送信元のチェーンから送られてきたメッセージ

このコントラクトで、まず最初に行わなければならないことは、送信された`message`へアクセスできるようにすることです。 メッセージが送信される前に、 `abi.encode()`に送ることでメッセージが`string`から`bytes`に変換されていたことを思い出してください。 `bytes`型から`string`型ににメッセージを変換し直すには、シンプルに`_payload`を `abi.decode()`に渡し、`_payload`を`string`型にデコードするように指定します。 これによって、文字列としてメッセージが返されます。

これで、メッセージを文字列型にでき、`sourceChain`とsourceAddress`のストレージ変数を`_sourceChain`と`_sourceAddress`をして設定でき、簡単に渡されたデータを参照できるようになります。 `Executed`イベントを、先ほどデコードした`sourceAddress`と`message\` イベントと一緒に発行することができます。

いい感じです。 この時点で、あなたは目的のチェーンでインターチェーントランザクションを処理しています。

コントラクトとやり取りをするには、少なくとも2つのブロックチェーンにデプロイする必要があります。1つのチェーンで`setRemoteValue()`を呼び出し、もう一方のチェーンで `_execute()`関数を自動的にトリガーするためです。 目的のチェーンで`sourceChain`と`sourceAddress`変数をクエリーすることで、インターチェーンの実行が正しく行われたことを確認することができます。

<a href="https://testnet.axelarscan.io" target="_blank">Axelarscan(テストネット)ブロックエクスプローラ</a>でインターチェーントランザクションの詳細をステップバイステップで表示して確認してみてください。
